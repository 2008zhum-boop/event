<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å·´ä¼¦2026 Â· é»„é‡‘ç½—ç›˜</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700;900&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* --- 1. è§†è§‰åŸºè°ƒï¼šçº¢é‡‘ + ä»ªè¡¨ç›˜é£æ ¼ --- */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: "Noto Serif SC", "PingFang SC", serif;
            background-color: #4a0404;
            background: linear-gradient(180deg, #8B0000 0%, #3e0202 100%);
            background-image: 
                radial-gradient(#6d0b0b 15%, transparent 16%),
                radial-gradient(#6d0b0b 15%, transparent 16%),
                linear-gradient(180deg, #8B0000 0%, #3e0202 100%);
            background-size: 20px 20px, 20px 20px, 100% 100%;
            background-position: 0 0, 10px 10px, 0 0;
            background-repeat: repeat, repeat, no-repeat;
            display: flex; justify-content: center; min-height: 100vh; color: #333; overflow-x: hidden;
        }

        #app-container {
            width: 100%; max-width: 414px; min-height: 100vh;
            padding-top: env(safe-area-inset-top); padding-bottom: env(safe-area-inset-bottom);
            position: relative; background: transparent; 
            display: flex; flex-direction: column;
        }

        /* é¡¶éƒ¨è£…é¥° & Logo */
        .decoration-top {
            position: absolute; top: -20px; left: 0; width: 100%; height: 80px;
            background: url('data:image/svg+xml;utf8,<svg viewBox="0 0 1440 320" xmlns="http://www.w3.org/2000/svg"><path fill="%23FFD700" fill-opacity="0.1" d="M0,224L48,213.3C96,203,192,181,288,181.3C384,181,480,203,576,224C672,245,768,267,864,250.7C960,235,1056,181,1152,165.3C1248,149,1344,171,1392,181.3L1440,192L1440,0L1392,0C1344,0,1248,0,1152,0C1056,0,960,0,864,0C768,0,672,0,576,0C480,0,384,0,288,0C192,0,96,0,48,0L0,0Z"></path></svg>');
            background-size: cover; z-index: 1;
        }
        .logo-container { margin-top: 35px; text-align: center; z-index: 10; padding: 0 20px; flex-shrink: 0; }
        .logo-img { width: 140px; height: auto; display: block; margin: 0 auto; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); }

        /* é€šç”¨ç»„ä»¶ */
        .hidden { display: none !important; }
        .fade-out { opacity: 0; pointer-events: none; transition: opacity 0.5s ease; }
        .fade-in { opacity: 1 !important; display: flex !important; }

        .btn {
            width: 100%; background: linear-gradient(135deg, #2ecbe9 0%, #1DB2D4 50%, #158ca7 100%);
            border: 2px solid rgba(255,255,255,0.2); color: #fff; font-family: "Noto Serif SC", serif;
            padding: 16px 0; font-size: 19px; font-weight: bold; border-radius: 50px;
            cursor: pointer; box-shadow: 0 8px 20px rgba(29, 178, 212, 0.4), 0 4px 0 #106e82;
            transition: all 0.2s ease; letter-spacing: 2px;
        }
        .btn:active { transform: translateY(4px); box-shadow: 0 4px 10px rgba(29, 178, 212, 0.2); }
        .btn-task { padding: 8px 15px; font-size: 13px; width: auto; background: linear-gradient(135deg, #FFD700, #FFA500); border: none; color: #8B0000; box-shadow: 0 3px 10px rgba(0,0,0,0.3); border-radius: 20px; cursor: pointer;}
        .btn-task.done { background: rgba(255,255,255,0.2); color: #aaa; box-shadow: none; pointer-events: none; }

        /* ================= PAGE 1: é…ç½®æ¨¡æ‹Ÿå™¨ (Simulator) ================= */
        #page-landing { flex: 1; display: flex; flex-direction: column; padding: 0 20px; z-index: 10; width: 100%; align-items: center; }
        
        .title-group { text-align: center; color: #fff; margin-top: 10px; margin-bottom: 20px; }
        .main-title { font-size: 26px; font-weight: 700; letter-spacing: 2px; margin-bottom: 5px; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
        .sub-title { font-size: 13px; color: #FFD700; letter-spacing: 1px; opacity: 0.9; }

        /* æ ¸å¿ƒäº¤äº’ï¼šåŠ¨æ€é¥¼å›¾ */
        .chart-container {
            width: 200px; height: 200px; border-radius: 50%;
            background: #fff; margin: 0 auto 30px auto;
            position: relative;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
            border: 4px solid rgba(255,255,255,0.1);
            /* åŠ¨æ€æ¸å˜ç”±JSæ§åˆ¶ */
            background: conic-gradient(#d32f2f 0% 33%, #FFD700 33% 66%, #1976D2 66% 100%);
            transition: background 0.3s ease;
        }
        /* ä¸­å¿ƒé®ç½©ï¼Œåšæˆç¯å½¢å›¾ */
        .chart-container::after {
            content: '2026'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 140px; height: 140px; background: #4a0404; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            color: #fff; font-size: 24px; font-family: "Playfair Display"; font-weight: bold;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.8);
        }

        /* æ§åˆ¶å° */
        .controls-panel {
            width: 100%; background: rgba(0,0,0,0.3); border-radius: 12px; padding: 20px;
            border: 1px solid rgba(255,255,255,0.1); margin-bottom: 20px;
        }
        
        .slider-group { margin-bottom: 20px; }
        .slider-label { display: flex; justify-content: space-between; color: #fff; font-size: 14px; margin-bottom: 8px; }
        .slider-val { font-family: "Roboto Mono"; font-weight: bold; }
        
        /* è‡ªå®šä¹‰æ»‘å—æ ·å¼ */
        input[type=range] {
            -webkit-appearance: none; width: 100%; height: 6px; border-radius: 3px; outline: none;
        }
        /* æ»‘å—é¢œè‰² */
        #range-growth { background: #d32f2f; } /* çº¢è‰²ï¼šè¿›æ”» */
        #range-balance { background: #FFD700; } /* é‡‘è‰²ï¼šç¨³å¥ */
        #range-hedge { background: #1976D2; }   /* è“è‰²ï¼šå¯¹å†² */

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; width: 20px; height: 20px; border-radius: 50%; 
            background: #fff; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.5); border: 2px solid #ccc;
        }

        .action-area { width: 100%; text-align: center; padding-bottom: 40px; margin-top: auto; }
        .hint-text { margin-top: 15px; color: rgba(255,255,255,0.6); font-size: 12px; letter-spacing: 1px; }

        /* ================= PAGE 2: è¯„æµ‹æŠ¥å‘Š (Report) ================= */
        #page-result { display: none; opacity: 0; width: 100%; flex: 1; flex-direction: column; align-items: center; padding: 20px; z-index: 15; transition: opacity 0.5s ease; }
        
        /* è¯„åˆ†å¡ */
        .score-card {
            width: 100%; background-color: #fffbe0;
            background-image: url("data:image/svg+xml,%3Csvg width='6' height='6' viewBox='0 0 6 6' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23d9d0b6' fill-opacity='0.4' fill-rule='evenodd'%3E%3Cpath d='M5 0h1L0 6V5zM6 5v1H5z'/%3E%3C/g%3E%3C/svg%3E");
            border-radius: 8px; padding: 30px 20px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.6);
            border: 1px solid #e0d0a0; text-align: center; margin-bottom: 30px;
            position: relative;
            animation: cardSlideUp 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        
        .score-circle {
            width: 80px; height: 80px; border: 4px solid #8B0000; border-radius: 50%;
            margin: 0 auto 15px auto; display: flex; justify-content: center; align-items: center;
            font-size: 32px; font-weight: 900; color: #8B0000; font-family: "Playfair Display";
        }
        .score-title { font-size: 20px; font-weight: bold; color: #333; margin-bottom: 10px; }
        .score-desc { font-size: 14px; line-height: 1.6; color: #555; text-align: justify; margin-bottom: 20px; }
        
        /* å·´ä¼¦å»ºè®®æ  */
        .barrons-advice {
            background: #f5f5f5; padding: 15px; border-left: 4px solid #FFD700; text-align: left;
        }
        .advice-label { font-size: 11px; color: #999; text-transform: uppercase; margin-bottom: 5px; }
        .advice-text { font-size: 13px; color: #333; font-weight: bold; }

        .gift-trigger { width: 100%; background: linear-gradient(135deg, #FF512F 0%, #DD2476 100%); border-radius: 10px; padding: 15px 20px; display: flex; align-items: center; justify-content: space-between; color: #fff; box-shadow: 0 8px 20px rgba(221, 36, 118, 0.4); cursor: pointer; animation: pulse 2s infinite; border: 1px solid rgba(255,255,255,0.3); }
        .gift-icon { font-size: 28px; margin-right: 15px; }
        .gift-text { text-align: left; flex: 1; }
        .gift-title { font-size: 16px; font-weight: bold; margin-bottom: 2px; }
        .gift-desc { font-size: 12px; opacity: 0.9; }
        .gift-arrow { font-size: 18px; opacity: 0.8; }

        /* ================= PAGE 3: è½¬åŒ–é¡µ (Offer) ================= */
        #page-offer { display: none; opacity: 0; width: 100%; flex: 1; flex-direction: column; align-items: center; justify-content: flex-start; z-index: 15; transition: opacity 0.5s ease; padding: 0 20px 40px 20px; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        .offer-header { text-align: center; margin-bottom: 20px; color: #fff; animation: cardSlideUp 0.6s ease; flex-shrink: 0; }
        .offer-header h2 { font-size: 24px; margin-bottom: 5px; color: #FFD700; text-shadow: 0 2px 5px rgba(0,0,0,0.5); }
        .offer-header p { font-size: 13px; opacity: 0.8; letter-spacing: 1px; }
        
        .price-card { width: 100%; background: rgba(0, 0, 0, 0.6); border: 1px solid rgba(255, 215, 0, 0.3); border-radius: 16px; padding: 30px 20px; text-align: center; margin-bottom: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); backdrop-filter: blur(10px); animation: cardSlideUp 0.8s ease; flex-shrink: 0; }
        .original-price { color: #aaa; text-decoration: line-through; font-size: 14px; margin-bottom: 5px; }
        .final-price-row { display: flex; justify-content: center; align-items: baseline; margin-bottom: 10px; }
        .currency { font-size: 24px; color: #FFD700; margin-right: 5px; }
        .price-num { font-size: 48px; font-weight: bold; color: #FFD700; font-family: 'Playfair Display', serif; line-height: 1; }
        .tag { background: linear-gradient(90deg, #FFD700, #FFA500); color: #8B0000; font-size: 12px; padding: 2px 8px; border-radius: 4px; font-weight: bold; margin-left: 10px; transform: translateY(-10px); }
        .daily-price { font-size: 14px; color: #fff; background: rgba(255,255,255,0.1); display: inline-block; padding: 4px 15px; border-radius: 20px; }
        
        .countdown-container { text-align: center; margin-bottom: 15px; margin-top: 5px; animation: cardSlideUp 1s ease; flex-shrink: 0; }
        .countdown-label { font-size: 12px; color: rgba(255,255,255,0.7); margin-bottom: 5px; }
        .timer-display { font-size: 20px; color: #FFD700; font-family: monospace; font-weight: bold; letter-spacing: 2px; }
        
        .section-title { color: #FFD700; font-size: 15px; margin: 30px 0 15px 0; opacity: 0.9; text-align: center; letter-spacing: 3px; font-weight: bold; display: flex; align-items: center; justify-content: center; animation: cardSlideUp 1.2s ease; flex-shrink: 0; }
        .section-title::before, .section-title::after { content: ''; display: block; width: 30px; height: 1px; background: linear-gradient(90deg, transparent, #FFD700); margin: 0 10px; }
        .section-title::after { background: linear-gradient(90deg, #FFD700, transparent); }
        
        .benefit-img { width: 100%; height: auto; border-radius: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.4); margin-bottom: 10px; animation: cardSlideUp 1.2s ease; border: 1px solid rgba(255,215,0,0.2); flex-shrink: 0; }
        
        .rules-container { width: 100%; background: rgba(0,0,0,0.2); padding: 20px; border-radius: 12px; margin-top: 20px; margin-bottom: 20px; border: 1px dashed rgba(255,255,255,0.15); animation: cardSlideUp 1.4s ease; flex-shrink: 0; }
        .rules-title { font-size: 12px; color: #ccc; margin-bottom: 8px; font-weight: bold; }
        .rules-list { list-style: none; text-align: left; padding: 0; margin: 0; }
        .rules-list li { font-size: 11px; color: rgba(255,255,255,0.5); line-height: 1.8; margin-bottom: 4px; text-align: justify; position: relative; padding-left: 12px; }
        .rules-list li::before { content: 'â€¢'; position: absolute; left: 0; color: #666; }
        .footer-note { font-size: 10px; color: rgba(255,255,255,0.3); text-align: center; margin-top: 0; margin-bottom: 20px; flex-shrink: 0; }

        /* --- ä»»åŠ¡ä¸­å¿ƒé¡µ --- */
        #page-tasks { display: none; opacity: 0; width: 100%; flex: 1; flex-direction: column; align-items: center; padding: 0 20px; z-index: 15; transition: opacity 0.5s ease; overflow-y: auto; }
        .task-list { width: 100%; margin-top: 20px; }
        .task-item { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,215,0,0.2); border-radius: 12px; padding: 15px; margin-bottom: 15px; display: flex; align-items: center; justify-content: space-between; animation: cardSlideUp 0.5s ease; }
        .task-info { display: flex; align-items: center; }
        .task-icon { font-size: 24px; margin-right: 15px; width: 40px; text-align: center; background: rgba(255,215,0,0.1); border-radius: 50%; height: 40px; line-height: 40px; }
        .task-desc h4 { font-size: 15px; color: #FFD700; margin-bottom: 4px; }
        .task-desc p { font-size: 11px; color: rgba(255,255,255,0.6); }
        .back-home { margin-top: 30px; font-size: 14px; color: #aaa; text-decoration: underline; cursor: pointer; margin-bottom: 40px; }

        /* --- æ‚¬æµ®æŒ‰é’®ç»„ --- */
        .float-btn-group { position: absolute; bottom: 30px; right: 20px; display: flex; flex-direction: column; gap: 15px; z-index: 999; }
        .float-btn { width: 50px; height: 50px; background: linear-gradient(135deg, #FFD700, #FFA500); border-radius: 50%; box-shadow: 0 5px 15px rgba(0,0,0,0.6), 0 0 0 2px rgba(255,255,255,0.8); display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer; animation: pulse-btn 3s infinite; }
        .float-btn.secondary { width: 40px; height: 40px; background: #fff; border: none; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        .float-btn span { font-size: 20px; }
        .float-btn.secondary span { font-size: 16px; }
        .float-btn p { font-size: 9px; color: #8B0000; font-weight: bold; margin-top: -2px; }

        /* --- å¼¹çª— --- */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 2000; display: none; justify-content: center; align-items: center; }
        .coupon-modal-content { width: 85%; max-width: 350px; background: #fff; border-radius: 15px; padding: 25px; text-align: center; position: relative; }
        .close-btn { position: absolute; top: 10px; right: 15px; font-size: 24px; color: #999; cursor: pointer; }
        .coupon-list-container { max-height: 300px; overflow-y: auto; margin-top: 15px; }
        .coupon-item { background: #fffbe0; border: 1px solid #FFD700; border-radius: 8px; padding: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .c-left h4 { font-size: 16px; color: #d93025; margin-bottom: 5px; }
        .c-left p { font-size: 12px; color: #666; }
        .c-btn { background: #d93025; color: #fff; border: none; padding: 5px 12px; border-radius: 20px; font-size: 12px; }
        .share-text { margin-top: 150px; color: #fff; font-size: 18px; line-height: 1.5; text-align: center; }

        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }
        @keyframes cardSlideUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes pulse-btn { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

    <div id="app-container">
        
        <div class="float-btn-group">
            <div class="float-btn secondary" onclick="goToTasks()"><span>âš¡</span></div>
            <div class="float-btn" onclick="showCouponModal()"><span>ğŸŸï¸</span><p>å¡åˆ¸</p></div>
        </div>

        <div class="decoration-top"></div>
        <div class="logo-container">
            <img src="https://admin.barrons.com.cn/uploads/cover_image/2026/01/19/1768790601_a5adc63e4ca8b95da3db.png" alt="Barron's Logo" class="logo-img">
        </div>

        <div id="page-landing">
            <div class="title-group">
                <h1 class="main-title">2026 å·´ä¼¦ Â· é»„é‡‘ç½—ç›˜</h1>
                <div class="sub-title">å¤§åŠ¿éœ‡è¡ï¼Œå”¯æœ‰é…ç½®æ˜¯ç©¿è¶Šå‘¨æœŸçš„ç½—ç›˜</div>
            </div>
            
            <div class="chart-container" id="allocationChart"></div>

            <div class="controls-panel">
                <div class="slider-group">
                    <div class="slider-label"><span>è¿›æ”» (AI/Tech)</span><span class="slider-val" id="val-growth">30%</span></div>
                    <input type="range" id="range-growth" min="0" max="100" value="30" oninput="updateChart()">
                </div>
                <div class="slider-group">
                    <div class="slider-label"><span>ç¨³å¥ (Dividend)</span><span class="slider-val" id="val-balance">40%</span></div>
                    <input type="range" id="range-balance" min="0" max="100" value="40" oninput="updateChart()">
                </div>
                <div class="slider-group">
                    <div class="slider-label"><span>å¯¹å†² (Gold/Crypto)</span><span class="slider-val" id="val-hedge">30%</span></div>
                    <input type="range" id="range-hedge" min="0" max="100" value="30" oninput="updateChart()">
                </div>
            </div>

            <div class="action-area">
                <div class="btn-wrapper">
                    <button class="btn" id="drawBtn" onclick="analyzePortfolio()">ç”Ÿæˆé…ç½®è¯„æµ‹</button>
                </div>
                <div class="hint-text" id="drawHint" onclick="goToTasks()">ä»Šæ—¥å‰©ä½™æœºä¼šï¼š100/100</div>
            </div>
        </div>

        <div id="page-result">
            <div class="score-card">
                <div class="score-circle" id="res-score">88</div>
                <h3 class="score-title" id="res-title">ç¨³å¥å¢é•¿å‹</h3>
                <p class="score-desc" id="res-desc">
                    æ‚¨çš„é…ç½®å±•ç°å‡ºæä½³çš„å¹³è¡¡æ„Ÿã€‚åœ¨2026å¹´çš„éœ‡è¡å¸‚ä¸­ï¼Œæ—¢ä¿ç•™äº†ç§‘æŠ€æˆé•¿çš„çˆ†å‘åŠ›ï¼Œåˆç­‘ç‰¢äº†ç°é‡‘æµæŠ¤åŸæ²³ã€‚
                </p>
                <div class="barrons-advice">
                    <div class="advice-label">Barron's Suggestion</div>
                    <div class="advice-text">â€œå»ºè®®é€‚å½“å¢åŠ 5%çš„æ–°å…´å¸‚åœºé…ç½®ï¼Œä»¥å¯¹å†²ç¾å…ƒèµ°å¼±é£é™©ã€‚ç‚¹å‡»ä¸‹æ–¹é¢†å–å®Œæ•´é…ç½®å»ºè®®ã€‚â€</div>
                </div>
            </div>

            <div class="gift-trigger" onclick="goToOffer()">
                <div class="gift-icon">ğŸ’¼</div>
                <div class="gift-text">
                    <div class="gift-title" id="res-gift-title">å·²ç”Ÿæˆâ€œå·´ä¼¦æ ‡å‡†é…ç½®å•â€</div>
                    <div class="gift-desc">ç‚¹å‡»å¯¹æ¯”å¤§å¸ˆç­–ç•¥å¹¶é¢†å–ä¼˜æƒ </div>
                </div>
                <div class="gift-arrow">á³</div>
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <button onclick="goToTasks()" style="background:transparent; border:1px solid rgba(255,215,0,0.5); color:#FFD700; padding: 5px 15px; border-radius: 20px; font-size: 13px;">âš¡ å¢åŠ è¯„æµ‹æ¬¡æ•°</button>
            </div>
        </div>

        <div id="page-offer">
            <div class="offer-header">
                <h2>é©¬å¹´é™å®šç¤¼é‡</h2>
                <p>åŠ©ä½ åœ¨2026ç¾è‚¡å¸‚åœºä¸€é©¬å½“å…ˆ</p>
            </div>
            <div class="price-card">
                <div class="original-price">åŸä»· Â¥ 1080 / å¹´</div>
                <div class="final-price-row">
                    <span class="currency">Â¥</span>
                    <span class="price-num" id="offer-price-num">518</span>
                    <span class="tag" id="offer-tag">å·²ä¼˜æƒ 562å…ƒ</span>
                </div>
                <div class="daily-price" id="offer-daily-price">å·²æ¯”å®˜ç½‘æ¸ é“ä»·è¿˜ä¼˜æƒ 180å…ƒ</div>
            </div>
            <div class="countdown-container">
                <div class="countdown-label">ä¼˜æƒ å¤±æ•ˆå€’è®¡æ—¶</div>
                <div class="timer-display" id="timer">04:59:59</div>
            </div>
            <div class="btn-wrapper" style="width: 100%; margin-bottom: 10px; animation: cardSlideUp 1s ease; flex-shrink: 0;">
                <button class="btn" onclick="alert('å³å°†è·³è½¬æ”¯ä»˜ç½‘å…³...')">å¼€å¯é©¬å¹´è´¢è¿</button>
            </div>
            <h3 class="section-title">ä¼šå‘˜æ ¸å¿ƒæƒç›Š</h3>
            <img src="https://admin.barrons.com.cn/uploads/cover_image/2026/01/19/1768794382_315d133577c4362dac71.jpg" alt="ä¼šå‘˜æƒç›Šä»‹ç»" class="benefit-img">
            <div class="rules-container">
                <div class="rules-title">æ´»åŠ¨è§„åˆ™è¯´æ˜ï¼š</div>
                <ul class="rules-list">
                    <li>æ´»åŠ¨æ—¶é—´ï¼šå³æ—¥èµ·è‡³2026å¹´2æœˆ12æ—¥ï¼ˆæ­£æœˆåäº”ï¼‰ã€‚</li>
                    <li>ä¼˜æƒ å¯¹è±¡ï¼šæœ¬ä¼˜æƒ ä»…é™å·´ä¼¦ä¸­æ–‡ç½‘æ³¨å†Œç”¨æˆ·å‚ä¸ã€‚</li>
                    <li>æƒç›Šå‘æ”¾ï¼šè®¢é˜…æˆåŠŸåï¼Œä¼šå‘˜æƒç›Šå°†å³æ—¶å‘æ”¾ã€‚</li>
                    <li>é€€æ¬¾è¯´æ˜ï¼šè™šæ‹Ÿå•†å“ï¼Œä¸€ç»å”®å‡ºæ¦‚ä¸é€€æ¬¾ã€‚</li>
                </ul>
            </div>
            <div class="footer-note">*æ´»åŠ¨æœ€ç»ˆè§£é‡Šæƒå½’å·´ä¼¦ä¸­æ–‡ç½‘æ‰€æœ‰</div>
        </div>

        <div id="page-tasks">
            <div class="offer-header">
                <h2>è·å–è¯„æµ‹æ¬¡æ•°</h2>
                <p>å®Œæˆä»¥ä¸‹ä»»åŠ¡ï¼Œä¼˜åŒ–æ‚¨çš„æŠ•èµ„ç»„åˆ</p>
            </div>
            <div class="task-list">
                <div class="task-item">
                    <div class="task-info"><div class="task-icon">ğŸ“…</div><div class="task-desc"><h4>æ¯æ—¥ç­¾åˆ°</h4><p>æ¯å¤©ä¸€æ¬¡ï¼Œä¿æŒå…³æ³¨</p></div></div>
                    <div><span style="color:#FFD700; font-size:12px; margin-right:5px;">+1æ¬¡</span><button class="btn btn-task" id="btn-checkin" onclick="doTask('checkin')">ç­¾åˆ°</button></div>
                </div>
                <div class="task-item">
                    <div class="task-info"><div class="task-icon">ğŸ’¬</div><div class="task-desc"><h4>åˆ†äº«ç»™å¾®ä¿¡å¥½å‹</h4><p>é‚€è¯·å¥½å‹æµ‹è¿åŠ¿</p></div></div>
                    <div><span style="color:#FFD700; font-size:12px; margin-right:5px;">+1æ¬¡</span><button class="btn btn-task" onclick="doTask('share_friend')">å»åˆ†äº«</button></div>
                </div>
                <div class="task-item">
                    <div class="task-info"><div class="task-icon">â­•</div><div class="task-desc"><h4>åˆ†äº«åˆ°æœ‹å‹åœˆ</h4><p>è®©æ›´å¤šäººçœ‹åˆ°ä½ çš„å¥½è¿</p></div></div>
                    <div><span style="color:#FFD700; font-size:12px; margin-right:5px;">+2æ¬¡</span><button class="btn btn-task" onclick="doTask('share_moments')">å»åˆ†äº«</button></div>
                </div>
                <div class="task-item">
                    <div class="task-info"><div class="task-icon">ğŸ“–</div><div class="task-desc"><h4>é˜…è¯»å·´ä¼¦æ·±åº¦æ–‡ç« </h4><p>æ´å¯Ÿ2026å¸‚åœºå…ˆæœº</p></div></div>
                    <div><span style="color:#FFD700; font-size:12px; margin-right:5px;">+1æ¬¡</span><button class="btn btn-task" id="btn-read" onclick="doTask('read_article')">å»é˜…è¯»</button></div>
                </div>
            </div>
            <div class="back-home" onclick="backToHome()">è¿”å›é¦–é¡µ</div>
        </div>

        <div id="couponModal" class="modal-overlay" onclick="closeModal(this)">
            <div class="coupon-modal-content" onclick="event.stopPropagation()">
                <div class="close-btn" onclick="closeModal(document.getElementById('couponModal'))">Ã—</div>
                <h3>æˆ‘çš„ç¤¼é‡</h3>
                <div class="coupon-list-container" id="couponList"></div>
            </div>
        </div>
        <div id="shareModal" class="modal-overlay" onclick="closeModal(this)">
            <div style="position: absolute; top: 10px; right: 20px; font-size: 40px; color: #fff;">â†—</div>
            <div class="share-text">
                <p>ç‚¹å‡»å³ä¸Šè§’ [...]</p><p>åˆ†äº«ç»™å¥½å‹æˆ–æœ‹å‹åœˆ</p><p style="margin-top: 20px; font-size: 14px; color: #FFD700;">æˆåŠŸåˆ†äº«åï¼Œç«‹å³è·å¾—å¥–åŠ±ï¼</p>
                <button onclick="simulateShareSuccess()" style="margin-top: 30px; background: #fff; color: #333; border: none; padding: 10px 30px; border-radius: 20px;">(æ¨¡æ‹Ÿ) åˆ†äº«æˆåŠŸ</button>
            </div>
        </div>
        
    </div>

    <script>
        // --- 1. é…ç½®æ•°æ® ---
        const BASE_DAILY_LIMIT = 100;
        const ORIGINAL_PRICE = 1080;

        const couponConfig = [
            { finalPrice: 518, prob: 0.1 },
            { finalPrice: 618, prob: 0.3 },
            { finalPrice: 688, prob: 0.4 },
            { finalPrice: 888, prob: 0.2 }
        ];

        let currentDrawResult = null;
        let currentTaskType = '';

        document.addEventListener('DOMContentLoaded', () => {
            updateDrawUI();
            updateChart(); // åˆå§‹åŒ–å›¾è¡¨
        });

        // --- 2. å›¾è¡¨è”åŠ¨é€»è¾‘ ---
        function updateChart() {
            const growth = parseInt(document.getElementById('range-growth').value);
            const balance = parseInt(document.getElementById('range-balance').value);
            const hedge = parseInt(document.getElementById('range-hedge').value);
            
            // ç®€å•å½’ä¸€åŒ–å¤„ç†ï¼Œç¡®ä¿æ€»å’Œå¡«å……é¥¼å›¾ (ä¸éœ€è¦ç²¾ç¡®100%ï¼Œè§†è§‰ä¸Šå¡«æ»¡å³å¯)
            const total = growth + balance + hedge;
            const p1 = (growth / total) * 100;
            const p2 = p1 + (balance / total) * 100;
            
            // æ›´æ–°æ•°å€¼æ˜¾ç¤º
            document.getElementById('val-growth').innerText = growth + "%";
            document.getElementById('val-balance').innerText = balance + "%";
            document.getElementById('val-hedge').innerText = hedge + "%";

            // æ›´æ–°é¥¼å›¾ (CSS Conic Gradient)
            const chart = document.getElementById('allocationChart');
            chart.style.background = `conic-gradient(
                #d32f2f 0% ${p1}%, 
                #FFD700 ${p1}% ${p2}%, 
                #1976D2 ${p2}% 100%
            )`;
        }

        // --- 3. æ ¸å¿ƒé€»è¾‘ ---

        function getPlayData() {
            const today = new Date().toDateString();
            const raw = localStorage.getItem('barrons_play_data_v9');
            let data = raw ? JSON.parse(raw) : null;
            if (!data || data.date !== today) {
                data = { date: today, used_count: 0, earned_count: 0, tasks: { checkin: false, read: false } };
                localStorage.setItem('barrons_play_data_v9', JSON.stringify(data));
            }
            return data;
        }

        function savePlayData(data) {
            localStorage.setItem('barrons_play_data_v9', JSON.stringify(data));
            updateDrawUI();
        }

        function getRemainingChances() {
            const data = getPlayData();
            return (BASE_DAILY_LIMIT + data.earned_count) - data.used_count;
        }

        function updateDrawUI() {
            const remaining = getRemainingChances();
            const btn = document.getElementById('drawBtn');
            const hint = document.getElementById('drawHint');
            
            if (remaining <= 0) {
                btn.innerText = "åšä»»åŠ¡å¾—æ¬¡æ•°";
                btn.onclick = goToTasks;
                btn.style.background = "linear-gradient(135deg, #FFD700, #FFA500)";
                btn.style.color = "#8B0000";
                hint.innerText = "ä»Šæ—¥æ¬¡æ•°ç”¨å®Œï¼Œåšä»»åŠ¡èµšå–æ›´å¤š";
            } else {
                btn.innerText = "ç”Ÿæˆé…ç½®è¯„æµ‹";
                btn.onclick = analyzePortfolio;
                btn.style.background = ""; 
                btn.style.color = "";
                hint.innerHTML = `ä»Šæ—¥å‰©ä½™æœºä¼šï¼š<span style="color:#fff; font-size:16px;">${remaining}</span>`;
            }

            const data = getPlayData();
            const checkinBtn = document.getElementById('btn-checkin');
            const readBtn = document.getElementById('btn-read');
            if (data.tasks.checkin) { checkinBtn.innerText = "å·²ç­¾åˆ°"; checkinBtn.classList.add('done'); }
            if (data.tasks.read) { readBtn.innerText = "å·²é˜…è¯»"; readBtn.classList.add('done'); }
        }

        // --- 4. ç”Ÿæˆè¯„æµ‹é€»è¾‘ ---

        function pickRandomCoupon() {
            const rand = Math.random();
            let accumulatedProb = 0;
            for (let c of couponConfig) {
                accumulatedProb += c.prob;
                if (rand <= accumulatedProb) {
                    return { finalPrice: c.finalPrice, discountAmount: ORIGINAL_PRICE - c.finalPrice };
                }
            }
            return { finalPrice: 688, discountAmount: ORIGINAL_PRICE - 688 };
        }

        function analyzePortfolio() {
            const remaining = getRemainingChances();
            if (remaining <= 0) { goToTasks(); return; }

            const data = getPlayData();
            data.used_count += 1;
            savePlayData(data);

            const coupon = pickRandomCoupon();
            
            // ç®€å•ç®—æ³•ç”Ÿæˆåˆ†æ•° (60-99ä¹‹é—´)
            const score = Math.floor(Math.random() * 30) + 70;
            let title = "å¹³è¡¡é…ç½®å‹";
            if(score > 90) title = "å·´ä¼¦å¤§å¸ˆçº§é…ç½®";
            else if(score < 75) title = "æ¿€è¿›å†’é™©å‹";

            currentDrawResult = {
                id: Date.now(),
                fortuneTitle: title, // ç±»å‹
                fortuneText: `é…ç½®è¯„åˆ†ï¼š${score}`, // æè¿°
                finalPrice: coupon.finalPrice,
                discount: coupon.discountAmount,
                date: new Date().toLocaleString()
            };

            // å¡«å……ç»“æœé¡µ
            document.getElementById('res-score').innerText = score;
            document.getElementById('res-title').innerText = title;
            document.getElementById('res-gift-title').innerText = `å·²ç”Ÿæˆâ€œä»·å€¼${coupon.discountAmount}å…ƒé…ç½®çº¢åŒ…â€`;

            updateOfferPage(currentDrawResult);
            saveCouponHistory(currentDrawResult);

            const btn = document.getElementById('drawBtn');
            btn.innerText = "Calculating Risk...";
            btn.style.opacity = "0.8";

            setTimeout(() => {
                const landing = document.getElementById('page-landing');
                const result = document.getElementById('page-result');
                
                landing.classList.add('fade-out');
                setTimeout(() => {
                    landing.classList.add('hidden');
                    result.classList.remove('hidden');
                    result.classList.add('fade-in');
                    btn.innerText = "ç”Ÿæˆé…ç½®è¯„æµ‹";
                    btn.style.opacity = "1";
                }, 500);
            }, 1000);
        }

        function updateOfferPage(data) {
            document.getElementById('offer-price-num').innerText = data.finalPrice;
            document.getElementById('offer-tag').innerText = `å·²ä¼˜æƒ ${data.discount}å…ƒ`;
            const saved = ORIGINAL_PRICE - data.finalPrice;
            document.getElementById('offer-daily-price').innerText = `å·²æ¯”å®˜ç½‘æ¸ é“ä»·è¿˜ä¼˜æƒ ${saved}å…ƒ`;
        }

        // --- 5. ä»»åŠ¡ä¸è·³è½¬ ---

        function doTask(type) {
            const data = getPlayData();
            currentTaskType = type;
            if (type === 'checkin') {
                if (data.tasks.checkin) return;
                data.tasks.checkin = true; data.earned_count += 1;
                savePlayData(data); alert('ç­¾åˆ°æˆåŠŸï¼è·å¾— +1 æ¬¡æœºä¼š');
            } else if (type === 'read_article') {
                if (data.tasks.read) return;
                alert('æ­£åœ¨è·³è½¬æ–‡ç« ...'); 
                setTimeout(() => { data.tasks.read = true; data.earned_count += 1; savePlayData(data); alert('é˜…è¯»å®Œæˆï¼è·å¾— +1 æ¬¡æœºä¼š'); }, 1000);
            } else {
                document.getElementById('shareModal').style.display = 'flex';
            }
        }

        function simulateShareSuccess() {
            const data = getPlayData();
            let reward = (currentTaskType === 'share_moments') ? 2 : 1;
            data.earned_count += reward;
            savePlayData(data);
            closeModal(document.getElementById('shareModal'));
            alert(`åˆ†äº«æˆåŠŸï¼è·å¾— +${reward} æ¬¡æœºä¼š`);
        }

        function saveCouponHistory(item) {
            let list = JSON.parse(localStorage.getItem('barrons_coupons_v9') || "[]");
            list.unshift(item);
            localStorage.setItem('barrons_coupons_v9', JSON.stringify(list));
        }

        function goToOffer() {
            hideAllPages();
            const page = document.getElementById('page-offer');
            if(currentDrawResult) updateOfferPage(currentDrawResult);
            page.classList.remove('hidden'); page.classList.add('fade-in');
            startTimer();
        }

        function showCouponModal() {
            const modal = document.getElementById('couponModal');
            const container = document.getElementById('couponList');
            const list = JSON.parse(localStorage.getItem('barrons_coupons_v9') || "[]");
            modal.style.display = 'flex';
            if (list.length === 0) {
                container.innerHTML = '<p style="margin-top:20px; color:#999; font-size:12px;">æš‚æ— å¡åˆ¸ï¼Œå¿«å»å¼€å¯æ—¥å†å§ï¼</p>';
            } else {
                let html = '';
                list.slice(0, 50).forEach(c => {
                    html += `
                        <div class="coupon-item">
                            <div class="c-left" style="text-align:left;">
                                <h4>Â¥${c.finalPrice} ä¸“äº«ä»·</h4>
                                <p>${c.fortuneTitle}</p>
                                <p style="font-size:10px; color:#999;">${c.date}</p>
                            </div>
                            <button class="c-btn" onclick="useHistoryCoupon(${c.finalPrice}, ${c.discount})">å»ä½¿ç”¨</button>
                        </div>`;
                });
                container.innerHTML = html;
            }
        }

        function useHistoryCoupon(price, discount) {
            updateOfferPage({ finalPrice: price, discount: discount });
            closeModal(document.getElementById('couponModal'));
            goToOffer();
        }

        function goToTasks() { hideAllPages(); const p = document.getElementById('page-tasks'); p.classList.remove('hidden'); p.classList.add('fade-in'); }
        function backToHome() { hideAllPages(); const p = document.getElementById('page-landing'); p.classList.remove('hidden'); p.classList.add('fade-in'); }
        function hideAllPages() { ['page-landing', 'page-result', 'page-offer', 'page-tasks'].forEach(id => { const el = document.getElementById(id); el.classList.add('hidden'); el.classList.remove('fade-in'); }); }
        function closeModal(m) { m.style.display = 'none'; }
        function startTimer() {
            let totalSeconds = 4 * 3600 + 59 * 60 + 59; 
            const timerElement = document.getElementById('timer');
            if(window.offerTimer) clearInterval(window.offerTimer);
            window.offerTimer = setInterval(() => {
                if (totalSeconds <= 0) { clearInterval(window.offerTimer); timerElement.innerText = "00:00:00"; return; }
                totalSeconds--;
                const h = Math.floor(totalSeconds / 3600);
                const m = Math.floor((totalSeconds % 3600) / 60);
                const s = totalSeconds % 60;
                timerElement.innerText = `${h < 10 ? '0'+h : h}:${m < 10 ? '0'+m : m}:${s < 10 ? '0'+s : s}`;
            }, 1000);
        }
    </script>
</body>
</html>